

<!DOCTYPE html>
<html>
  <head>
    <title>
	Builder Pattern :: Mortar Documentation
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2020-12-11T16:06:21 IST">
<meta name="description" content="">



<title>Builder Pattern :: Mortar Documentation</title>

<link rel="shortcut icon" href='/images/favicon.png' type="image/x-icon" />

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css">

<script src='https://code.jquery.com/jquery-3.5.1.min.js'></script>

<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel="stylesheet">



<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/sass/layout.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/css/style.main.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/css/style.menu.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/sass/shortcodes/notice.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/sass/shortcodes/tabs.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/sass/shortcodes/panel.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/sass/shortcodes/columns.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/sass/shortcodes/children.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/sass/shortcodes/attachments.css'>
<link rel="stylesheet" type="text/css" href='https://go-masonry.github.io/sass/shortcodes/alert.css'>
<link rel="stylesheet" type="text/css" href='/css/docport.css'>

<script src='/js/docport.js'></script>
<script type="text/javascript">
      var baseurl = "https:\/\/go-masonry.github.io\/";
</script>




    
  </head>

  <body data-url="/mortar/builders/"

  class="">

<style type="text/css">
  #debug{
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    line-height: 3.5rem;
    margin-bottom: .35rem;
    padding: 0 2rem;
    position: fixed;
    left: 0;      right: 0;     top: 0;
   
    top:0px;
    
    min-height: 150px;

    background-color: white;
    border: 3px solid red;
    z-index: 10000 ;
    word-wrap: all;
    overflow: auto;
  }
</style>
 


    
    
    <header style="">
        <div>
    
    <div class="burger ">
        <a href="javascript:void(0);" style="font-size:15px;" onclick="$('article > aside').toggleClass('responsive')">&#9776;</a>
    </div>
    

    <div>

		
	
			
		
	    	<a class='baselink' href='https://go-masonry.github.io/'>Mortar Documentation</a>
	  	
	</div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://github.com/go-masonry/mortar-demo"  rel="noopener">
                  Demo
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/go-masonry/mortar"  rel="noopener">
                  Github
                </a>
            </li>
    </nav>

</div>
    </header>
    

    <article>
      
      <aside class="">
        

		
	
			
		
	    	
	  	
	<div id="close_menu">
  <a href="javascript:void(0);" style="font-size:15px;" onclick="$('article > aside').toggleClass('responsive')">
      <i class="fa fa-lg fa-times"></i>
  </a>
</div>

<ul class="menu">

    <li data-nav-id="https://go-masonry.github.io/api/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/api/">APIs</a>
      
        <ul>
              

    <li data-nav-id="https://go-masonry.github.io/api/grpc/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/api/grpc/">gRPC</a>
      
        
      
    </li>
              

    <li data-nav-id="https://go-masonry.github.io/api/rest/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/api/rest/">REST Handlers</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://go-masonry.github.io/fx/" class="dd-item
        item_level_$level
        ">

      
      
      
      
        
      
          <a href="/fx/">Uber-FX</a>
      
    </li>
    

    <li data-nav-id="https://go-masonry.github.io/middleware/" class="dd-item haschildren
        item_level_$level
        ">

      
      
      
      <i class="fas fa-chevron-right ddexp"></i>
        
      
          <a href="/middleware/">Middleware</a>
      
        <ul>
              
              

    <li data-nav-id="https://go-masonry.github.io/middleware/telemetry/" class="dd-item
        item_level_$level
        ">

      
      
      
      
          <a href="/middleware/telemetry/">Telemetry</a>
      
        
      
    </li>
        </ul>
    </li>
    

    <li data-nav-id="https://go-masonry.github.io/mortar/" class="dd-item parent active
        item_level_$level
        ">

      
      
      
      
        
      
          <a href="/mortar/">Mortar Design</a>
      
    </li>
    



</ul>

		
	
			
		
	    	
	  	
	
      </aside>
      

      <section class="page ">
      
	
    
    
    <nav id="ariane" aria-label="breadcrumb">
      <ol class="ariane">
        
  
  	
		
  
  	
	<li >
      <a class="text-link" href="https://go-masonry.github.io/">
        Home
      </a>
    </li>
	
  
    <li class="">
      <a class="text-link" href="/mortar/">
        Mortar Design
      </a>
    </li>
	
  	
  
    <li class="active">
      
        Builder Pattern
      
    </li>

      </ol>
    </nav>
    
    

    
		
        
		
		
		
		
		
		
		

		
			<h1>Mortar Design<span>Builder Pattern</span></h1>
        

			
			
		

		
				<nav class="subpages">
	            		
	        			
	            	<li >
	            		<a title="$pagetitle" href="/mortar/bricks/">Bricks</a>
	            	</li>
	            		
	        			
	            	<li class="active">
	            		<a title="$pagetitle" href="/mortar/builders/">Builder Pattern</a>
	            	</li>
	            		
	        			
	            	<li >
	            		<a title="$pagetitle" href="/mortar/config/">Configuration Map</a>
	            	</li>
	            		
	        			
	            	<li >
	            		<a title="$pagetitle" href="/mortar/listeners/">Listeners</a>
	            	</li>
	        	</nav> 
		
	

	
	
	<div class="jump-to-section">
		<span onclick="$h = $(this);$h.next('nav').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('nav').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
  			<span class="fas fa-align-right"></span>
  			Jump to Section
  			<i style=";" class="fas fa-chevron-right"></i>
		</span>
		<nav id="TableOfContents">
  <ul>
    <li><a href="#motivation">Motivation</a>
      <ul>
        <li><a href="#library-usage-within-the-organization">Library usage within the organization</a></li>
        <li><a href="#our-library">Our Library</a></li>
        <li><a href="#what-is-it-about-then">What is it about then?</a></li>
      </ul>
    </li>
    <li><a href="#builder">Builder</a></li>
    <li><a href="#linked-list">Linked list</a>
      <ul>
        <li><a href="#overriding-predefined-defaults">Overriding predefined defaults</a></li>
      </ul>
    </li>
    <li><a href="#implementation">Implementation</a></li>
  </ul>
</nav>
	</div>
	
	






	<div class="content">
	    <p>You probably used to <a href="https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis">Functional Options</a> pattern.
But we found Builder pattern to be very useful, here we will explain why.</p>
<h2 ref="motivation" >Motivation</h2><a class="anchor" id="motivation"></a>
<ul>
<li>&ldquo;See&rdquo; all the options without searching for them</li>
<li>Partial Builders
<ul>
<li>Override previously set values</li>
</ul>
</li>
</ul>
<h3 ref="library-usage-within-the-organization" >Library usage within the organization</h3><a class="anchor" id="library-usage-within-the-organization"></a>



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">+---------------------+            +-------------------------------+           +-------------------------+
|  Library Developer  | +--------&gt; | Platform/Infra/Ops Developer  | +-------&gt; |  Integration Developer  |
+---------------------+            +-------------------------------+           +-------------------------+

Develops the library to be used    Pre Configure the library specifically      Set final values
in different scenarios, expose     to their organization.                      according to specific use case
different options

     Library defaults                  Predefined defaults                       Override defaults
</code></pre></div></p>
  </div></div>

<h3 ref="our-library" >Our Library</h3><a class="anchor" id="our-library"></a>
<p>Let&rsquo;s pretend we are building a library. Our library will have a constructor.</p>



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-golang" data-lang="golang"><span style="color:#00f">func</span> NewLib(options ...Option) Library {}

<span style="color:#00f">type</span> Option <span style="color:#00f">func</span>(*libConf)
</code></pre></div></p>
  </div></div>

<p>Configuration will be stored in <code>libConf</code>



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-golang" data-lang="golang"><span style="color:#00f">type</span> libConf <span style="color:#00f">struct</span> {
    address <span style="color:#2b91af">string</span>
    <span style="color:#008000">// other options omitted for clarity...
</span><span style="color:#008000"></span>}

<span style="color:#00f">func</span> Address(addr <span style="color:#2b91af">string</span>) Option {
    <span style="color:#00f">return</span> <span style="color:#00f">func</span>(cfg *libConf) {
        cfg.address = addr
    }
}
</code></pre></div></p>
  </div><div class="card-footer text-muted">There can also be a different kind of option that will look similar to this, but the idea is the same</div></div>
</p>
<h3 ref="what-is-it-about-then" >What is it about then?</h3><a class="anchor" id="what-is-it-about-then"></a>
<p>The purpose of this pattern to &ldquo;introduce&rdquo; or &ldquo;unite&rdquo; between a library developer and the platform/infra developer as shown in the above chart.
We want to introduce predefined defaults that are specific to the organization/use case and are not just library specific.
Let&rsquo;s examine our Library again, we have to set an <code>address</code> since our library needs to connect to some server.
We can look at this problem from difference perspectives:</p>



<div class="card "><div class="card-header primary">Library Developer</div><div class="card-body">
    <p class="card-text"><p>The library developer have no idea about your IP address right ? Hence the exposed <code>Option</code> to set the address.
However to find that option or any others you will need to look at the source code, right ?</p>
</p>
  </div></div>

<p>


<div class="card "><div class="card-header primary">Infrastructure/Platform developer within your organization</div><div class="card-body">
    <p class="card-text"><p>Infrastructure/Platform developer already setup this server and now needs to tell every &ldquo;Integration developer&rdquo; what that address is</p>
</p>
  </div></div>




<div class="card "><div class="card-header primary">Integration Developer</div><div class="card-body">
    <p class="card-text"><p>Either knows or not about this server IP that was introduced by the Platform/Infrastructure team but still needs to have a way to override it.
Because this IP can change with time or there is a local server that is used during tests.</p>
</p>
  </div></div>
</p>
<h2 ref="builder" >Builder</h2><a class="anchor" id="builder"></a>



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-golang" data-lang="golang"><span style="color:#00f">type</span> LibBuilder <span style="color:#00f">interface</span> {
    Address(addr <span style="color:#2b91af">string</span>) LibBuilder
    <span style="color:#008000">// ... additional options omitted for clarity
</span><span style="color:#008000"></span>    Build() Library
}
</code></pre></div></p>
  </div></div>

<p>So far nothing new, you can even look at it as a set of Options without the ability to extend and not breaking the API. And you right, however it&rsquo;s not intended as a drop in replacement for Functional Options.</p>
<h2 ref="linked-list" >Linked list</h2><a class="anchor" id="linked-list"></a>
<p>Builder implementation is based on a linked list



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">                                               +-------------------------------+
                                               |                               |
                 +----------------------------&gt;+         Configuration         |
                 |                             |                               |
                 |                             +-------+------------------+----+
                 |                                     ^                  ^
                 |                                     |                  |
       +---------+-----------+         +---------------+-----+         +--+------------------+
       |                     |         |                     |         |                     |
+-----&gt;+  Address Option     +--------&gt;+  Max     Option     +--------&gt;+  Min     Option     |
       |                     |         |                     |         |                     |
       +---------------------+         +---------------------+         +---------------------+
</code></pre></div></p>
  </div></div>
</p>
<p>Each <code>Option</code> is presented as a function on the the builder interface and added a to a list of previous options.


<div class="notices primary">
	<p>Each Builder function is an <em>alias</em> to Functional Option</p>
</div>
</p>
<h3 ref="overriding-predefined-defaults" >Overriding predefined defaults</h3><a class="anchor" id="overriding-predefined-defaults"></a>
<p>Since it&rsquo;s a list of Options we can add a <em>new option</em> to the end of a list that will actually <strong>override</strong> a previous one.



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">                                               +-------------------------------+
                                               |                               |
                 +----------------------------&gt;+         Configuration         |
                 |                             |                               |
                 |                             +-------+------------------+----+
                 |                                     ^                  ^
                 |                                     |                  |
       +---------+-----------+         +---------------+-----+         +--+------------------+         +---------------------+
       |                     |         |                     |         |                     |         |                     |
+-----&gt;+  Address Option     +--------&gt;+  Max     Option     +--------&gt;+  Min     Option     +--------&gt;+  Address Option     |
       |                     |         |                     |         |                     |         |                     |
       +---------+-----------+         +---------------------+         +---------------------+         +-----------+---------+
                 ^                                                                                                 |
                 |                                                                                                 |
                 +-----------------------------------------OVERRIDES-----------------------------------------------+
     +                                                                                           +
     |                                                                                           |
     +---------------------------------------Predefined defaults---------------------------------+

</code></pre></div></p>
  </div></div>
</p>
<h2 ref="implementation" >Implementation</h2><a class="anchor" id="implementation"></a>
<p>Finally let&rsquo;s just build it



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-golang" data-lang="golang"><span style="color:#00f">import</span> (
	<span style="color:#a31515">&#34;fmt&#34;</span>
	<span style="color:#a31515">&#34;container/list&#34;</span>
)

<span style="color:#00f">type</span> libConf <span style="color:#00f">struct</span> {
	address <span style="color:#2b91af">string</span>
}

<span style="color:#00f">type</span> Library <span style="color:#2b91af">string</span>
<span style="color:#00f">type</span> LibBuilder <span style="color:#00f">interface</span> {
	Address(addr <span style="color:#2b91af">string</span>) LibBuilder
	<span style="color:#008000">// ... additional options omitted for clarity
</span><span style="color:#008000"></span>	Build() Library
}
<span style="color:#00f">type</span> libBuilder <span style="color:#00f">struct</span> {
	ll *list.List
}

<span style="color:#00f">func</span> Builder() LibBuilder {
	<span style="color:#00f">return</span> &amp;libBuilder{
		ll: list.New(),
	}
}
<span style="color:#00f">func</span> (b *libBuilder) Address(addr <span style="color:#2b91af">string</span>) LibBuilder {
	b.ll.PushBack(<span style="color:#00f">func</span>(cfg *libConf) {
		fmt.Printf(<span style="color:#a31515">&#34;using %s as an address\n&#34;</span>, addr) <span style="color:#008000">// for debug
</span><span style="color:#008000"></span>		cfg.address = addr
	})
	<span style="color:#00f">return</span> b
}
<span style="color:#00f">func</span> (b *libBuilder) Build() Library {
	<span style="color:#00f">var</span> cfg = new(libConf) <span style="color:#008000">// empty conf
</span><span style="color:#008000"></span>	<span style="color:#008000">// Iterate on the linked list
</span><span style="color:#008000"></span>	<span style="color:#00f">for</span> e := b.ll.Front(); e != <span style="color:#00f">nil</span>; e = e.Next() {
		f := e.Value.(<span style="color:#00f">func</span>(*libConf)) <span style="color:#008000">// extract and cast
</span><span style="color:#008000"></span>		f(cfg)
	}
	<span style="color:#008000">// at this point cfg will be populated
</span><span style="color:#008000"></span>	<span style="color:#00f">return</span> Library(fmt.Sprintf(<span style="color:#a31515">&#34;We are going to call [%s] address&#34;</span>, cfg.address)) <span style="color:#008000">// or something similar
</span><span style="color:#008000"></span>}
</code></pre></div></p>
  </div></div>
</p>
<p>Once we have our builder we will use it as follows</p>



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-golang" data-lang="golang"><span style="color:#00f">func</span> makeLibrary(partialBuilder LibBuilder) Library {
    <span style="color:#008000">// here we have passed previously defined builder, one that have some defaults already in it
</span><span style="color:#008000"></span>    <span style="color:#008000">// Now we can either use it as is or override it
</span><span style="color:#008000"></span>    builder := partialBuilder.Address(<span style="color:#a31515">&#34;5678&#34;</span>)
    <span style="color:#00f">return</span> builder.Build()
}

<span style="color:#00f">func</span> main() {
	<span style="color:#00f">var</span> builder = Builder().Address(<span style="color:#a31515">&#34;1234&#34;</span>) <span style="color:#008000">// predefined builder
</span><span style="color:#008000"></span>	lib:=makeLibrary(builder)
	fmt.Println(lib)
}
</code></pre></div></p>
  </div></div>

<p>Now if you <a href="https://play.golang.org/p/B_le8viHPKt">run it</a> the output will be



<div class="card "><div class="card-body">
    <p class="card-text"><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">using 1234 as an address
using 5678 as an address
We are going to call [5678] address
</code></pre></div></p>
  </div></div>
</p>

		</div>






	 
	<div class="chevrons">
		<a class="next" href="/api/grpc/" title="gRPC" style="margin-right: 0px;">
            <div>
                <p>Next page</p>
                <label>gRPC</label>
            </div>
            <i class="fas fa-arrow-right" style="font-size: 1.7em"></i></a>
	</div>
	

      </section>

      
      
      <section class="right-menu ">
      
	

		
	
			
		
	    	
	  	
	<div class="TableOfContents">
    <label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What&#39;s on this page</label>
    <nav>
        <ul >
            <li><a href="/mortar/builders/">Builder Pattern</a></li>
        </ul>
    </nav>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#motivation">Motivation</a>
      <ul>
        <li><a href="#library-usage-within-the-organization">Library usage within the organization</a></li>
        <li><a href="#our-library">Our Library</a></li>
        <li><a href="#what-is-it-about-then">What is it about then?</a></li>
      </ul>
    </li>
    <li><a href="#builder">Builder</a></li>
    <li><a href="#linked-list">Linked list</a>
      <ul>
        <li><a href="#overriding-predefined-defaults">Overriding predefined defaults</a></li>
      </ul>
    </li>
    <li><a href="#implementation">Implementation</a></li>
  </ul>
</nav>
</div>

		
	
			
		
	    	
	  	
	<div class="Actions">
	<nav>
		<ul>
				
		    
		    
			
		      <li>
		          <i class='fas fa-calendar'></i>
		          Last update on 10 December 2020
		      </li>
		    
		    

    	</ul>
	</nav>
    
</div>

      </section>
      
    </article>
    
    
    <footer>
      

		
	
			
		
	    	
	    
	
    </footer>
    



  </body>
</html>
